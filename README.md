# 基于stm32f407的自动行驶小车

## 整体结构

### 器件选型

#### stm32f407vgt6
#### tb6612+520编码电机
#### 亚博智能8路灰度传感器
带有8根直传信号线+1个i2c接口+1个uart接口

可以通过i2c接口或者uart接口有效减少开发板的接口占用

#### pca9685+25kg数字舵机

带有一个i2c接口和16路的舵机控制接口

#### jy61p陀螺仪

6轴陀螺仪，零飘小，精度高达±0.5°

### 连线结构

stm32通过杜邦线连接tb6612驱动板，驱动板连接后面两个520编码电机

stm32通过i2c1接口连接一个i2c bus，i2c bus下挂2个i2c设备，其中一个是8路灰度巡线，另一个是pca9685，可以实现io接口的复用

stm32通过uart1连接串口，通过uart2连接jy61p

pca9685通过pwm线和电源线连接舵机

### 控制结构
stm32通过2个pwm接口、4个普通io接口、4个timer接口连接tb6612驱动板，实现控制电机的正反转，控制电机的占空比控制电机转速，通过时钟线来接收编码电机的脉冲，从而得知电机的实际转速，再根据pid算法来调整占空比从而达到精准的速度控制。

8路灰度通过i2c传回传感器的数据给stm32，当巡线时，根据灰度的01值来判断目前车头和循迹线的相对位置。

当循迹线处于偏左位置，则通过i2c想pca9685发送较长高电平的脉冲给舵机，控制前轮左转，反之发送较短电平的脉冲给舵机，控制前轮右转。

当小车走直线时，由于车身结构原因，小车可能会有轻微角度的偏移，所以我们采用陀螺仪来校准方向，当角度偏离过大时能够及时纠正。